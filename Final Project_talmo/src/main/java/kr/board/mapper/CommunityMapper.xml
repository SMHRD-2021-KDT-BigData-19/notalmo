<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.board.mapper.CommunityMapper">
    
	<!-- 게시물(작성자,카테고리,제목,내용) 등록 -->
	<insert id="PostUploadmapper" parameterType="kr.board.entity.PostContentDTO" keyProperty="post_id" useGeneratedKeys="true">
	    insert into posts (user_id,title,content,category) values(#{user_id}, #{title}, #{content}, #{category})
	</insert>
	
	
	<!-- 게시물(이미지) 등록 -->
	<insert id="PostImgUploadmapper" parameterType="kr.board.entity.PostImageDTO">
	    insert into pictures (post_id,folder,file_name) values(#{post_id}, #{folder}, #{file_name})
	</insert>
	
	<!-- 게시물 리스트 모두 가져오기 -->
	<select id="PostGetList" resultType="kr.board.entity.PostListGetDTO">
        <![CDATA[ SELECT posts.post_id, posts.user_id, posts.title, posts.category, posts.create_date, users.nick, posts.view_cnt
		FROM posts
		JOIN users ON posts.user_id = users.user_id
		WHERE posts.report_cnt <= 10
		ORDER BY posts.post_id DESC ]]>
    </select>
    
	<!-- 내가 쓴 게시물 리스트 모두 가져오기 -->
	<select id="MyPostGetList" parameterType="int" resultType="kr.board.entity.PostListGetDTO">
        SELECT posts.post_id, posts.user_id, posts.title, posts.category, posts.create_date, users.nick, posts.view_cnt
		FROM posts
		JOIN users ON posts.user_id = users.user_id
		WHERE posts.user_id = #{user_id}
		ORDER BY posts.post_id DESC
    </select>
    
	<!-- 메인페이지 게시물 리스트 5개 가져오기 -->
	<select id="MainPagePostList" parameterType="int" resultType="kr.board.entity.PostListGetDTO">
        SELECT posts.post_id, posts.user_id, posts.title, posts.category, posts.create_date, users.nick, posts.view_cnt
		FROM posts
		JOIN users ON posts.user_id = users.user_id
		ORDER BY posts.post_id DESC
		LIMIT 5
    </select>
    
	<!-- 게시물 내용 가져오기 -->
	<select id="CTextGet" parameterType="int" resultType="kr.board.entity.CTextGetDTO">
        SELECT posts.*, users.nick
        FROM posts
		JOIN users ON posts.user_id = users.user_id
		WHERE posts.post_id = #{post_id}
    </select>
    
	<!-- 게시물 사진 가져오기 -->
	<select id="CImgGet" parameterType="int" resultType="kr.board.entity.CImgGetDTO">
        SELECT picture_id, folder, file_name FROM pictures WHERE post_id=#{post_id}
    </select>
    
	<!-- 댓글 가져오기 -->
	<select id="CommentGet" parameterType="int" resultType="kr.board.entity.CommentDTO">
	    <![CDATA[ SELECT comments.comment_id, comments.user_id, comments.content, comments.create_date, users.nick
	    FROM comments
	    JOIN users ON comments.user_id = users.user_id
	    WHERE comments.post_id=#{post_id} AND comments.report_cnt <= 10 ]]>
	</select>
    
	<!-- 댓글 등록 -->
	<insert id="Comment" parameterType="kr.board.entity.CommentDTO">
	    insert into comments (post_id, user_id, content) values(#{post_id}, #{user_id}, #{content})
	</insert>
	
	<!-- 게시물 삭제 -->
	<delete id="PostDelete" parameterType="int">
		delete from posts where post_id=#{post_id}
	</delete>
	
	<!-- 댓글 삭제 -->
	<delete id="CommentDelete" parameterType="int">
		delete from comments where comment_id=#{comment_id}
	</delete>

</mapper>